#include Makefile.include

BUILDTOOLS = help2man autoconf automake libtool pkg-config yasm cmake

SUBDIRS = \
	ncurses pcre expat libiconv gettext readline sqlite3 libgpg-error \
	libgcrypt bzip2 liblzo2 libzip freetype2 fontconfig \
	openssl libssh2 curl \
	libjpeg-turbo tiff jasper libpng \
	libogg libvorbis libflac libid3tag libmad fribidi libmpeg2 \
	libass libsamplerate \
	libmodplug librtmp libxml2 yajl libmicrohttpd mysql \
	python26 samba alsa-lib libcdio libnfs afpfs-ng libshairport \
	libplist libcec libbluray boost tinyxml dummy-libxbmc

.PHONY: buildtools $(BUILDTOOLS) subdirs $(SUBDIRS)

all: subdirs

release: armeabi-v7a x86

# Dependency layout for parallel builds
gettext: libiconv
libgcrypt: libgpg-error
fontconfig: freetype2 expat libiconv
libssh2: libgcrypt openssl
curl: openssl libssh2
tiff: libjpeg-turbo
jasper: libjpeg-turbo
libvorbis: libogg
libflac: libogg
libass: fontconfig libpng freetype2 expat libiconv
librtmp: openssl
libxml2: libiconv
libmicrohttpd: openssl libgpg-error libgcrypt
python26: sqlite3 expat libxml2 openssl
libcdio: libiconv
afpfs-ng: libgcrypt readline libiconv
libshairport: openssl
libplist: libxml2 cmake
libbluray: libiconv libxml2
yajl: cmake

X86OVERRIDES=XBMC_OVERRIDE_HOST=i686-android-linux XBMC_OVERRIDE_TOOLCHAIN=$(XBMC_X86_TOOLCHAIN)
ARMOVERRIDES=XBMC_OVERRIDE_HOST=arm-linux-androideabi XBMC_OVERRIDE_TOOLCHAIN=$(XBMC_ARM_TOOLCHAIN)

buildtools: $(BUILDTOOLS)
$(BUILDTOOLS):
	$(MAKE) -C $@

subdirs: $(SUBDIRS)
$(SUBDIRS): help2man autoconf automake libtool pkg-config yasm
	$(MAKE) -C $@
	@echo "Dependencies built successfully."
clean:
	for d in $(BUILDTOOLS); do $(MAKE) -C $$d clean; done
	for d in $(SUBDIRS); do $(MAKE) -C $$d clean; done

distclean::
	for d in $(BUILDTOOLS); do $(MAKE) -C $$d distclean; done
	for d in $(SUBDIRS); do $(MAKE) -C $$d distclean; done

armeabi-v7a: $(XBMC_ARM_TOOLCHAIN)
	XBMC_OVERRIDE_PLATFORM=$@ $(ARMOVERRIDES) $(MAKE) all

x86: $(XBMC_X86_TOOLCHAIN)
	XBMC_OVERRIDE_PLATFORM=$@ $(X86OVERRIDES) $(MAKE) all

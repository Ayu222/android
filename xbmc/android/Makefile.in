include @abs_top_srcdir@/tools/android/depends/Makefile.include
include @abs_top_srcdir@/tools/android/depends/android-sdk.mk

GLUEPATH = $(NDKROOT)/sources/android/native_app_glue
CFLAGS  += -I@abs_top_srcdir@/xbmc -I$(GLUEPATH) -I$(PREFIX)/lib/libzip/include
LDFLAGS += -llog -landroid -Wl,--no-undefined

SRCS     = $(GLUEPATH)/android_native_app_glue.c \
           android_main.cpp \
           EventLoop.cpp \
           XBMCApp.cpp \
           unzip.cpp

UTILS    = android_utils.cpp
UTIL_LIB = android_utils.a
SOLIB    = libxbmcapp.so

all: $(SOLIB)

$(UTIL_LIB): $(UTILS)
	$(CXX) $(CFLAGS) $(LDFLAGS) -c -o $(@:.a=.o) $(UTILS)
	$(AR) cr $@ $(UTILS:.cpp=.o)


$(SOLIB): $(SRCS) $(UTIL_LIB)
	$(CXX) $(INCLUDES) $(CFLAGS) $(LDFLAGS) -lz -Wl,--whole-archive -lzip -Wl,--no-whole-archive -o $@ -shared $(SRCS) $(UTIL_LIB)

install: $(SOLIB)
	install $(SOLIB) $(PREFIX)/lib/$(SOLIB)

clean:
	-@rm -f $(SOLIB) $(UTIL_LIB) *.o 2>/dev/null || true
